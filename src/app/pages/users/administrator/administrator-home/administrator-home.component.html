<div class="home-container">
  <app-header-title
    [title]="'Dashboard Analítico'"
    [subtitle]="'Visão geral da plataforma TripMaker'"
  ></app-header-title>

  @if (isLoading) {
  <main class="main-content">
    <p>Carregando dados do dashboard...</p>
  </main>
  } @else {
  <main class="main-content">
    <!-- FILTROS -->
    <section class="filters-container" ngSkipHydration>
      <div class="filter-group">
        <h4 class="filter-label">Período</h4>
        <mat-chip-listbox
          class="filter-chip-list"
          aria-label="Selecionar período"
          [formControl]="periodControl"
        >
          @for (period of periods; track period.value) {
          <mat-chip-option [value]="period.value">{{ period.label }}</mat-chip-option>
          }
        </mat-chip-listbox>
      </div>

      <div class="filter-group">
        <h4 class="filter-label">Micro-Região / Cidade</h4>
        <mat-chip-listbox
          class="filter-chip-list"
          aria-label="Selecionar região"
          [formControl]="regionControl"
        >
          @for (region of regions; track region.value) {
          <mat-chip-option [value]="region.value">{{ region.label }}</mat-chip-option>
          }
        </mat-chip-listbox>
      </div>
    </section>

    <!-- 2. BIG NUMBERS (KPIs de Alto Nível) -->
    <section class="kpi-container">
      @for (kpi of kpis; track kpi.title) {
      <div class="kpi-card">
        <div class="kpi-header">
          <p class="kpi-title">{{ kpi.title }}</p>
          <mat-icon class="kpi-icon" [style.background-color]="kpi.color">{{ kpi.icon }}</mat-icon>
        </div>
        <strong class="kpi-value">{{ kpi.value }}</strong>
        <span class="kpi-unit">{{ kpi.unit }}</span>
      </div>
      }
    </section>

    <!-- 3. ANÁLISES E GRÁFICOS -->
    <div class="charts-container">
      <!-- 3A. Análise de Crescimento de Usuários -->
      <div class="chart-card">
        <h3 class="chart-header">Crescimento de Usuários por Perfil</h3>
        <div class="chart-canvas">
          <canvas #growthChart></canvas>
        </div>
      </div>

      <div class="charts-row">
        <!-- 3B. Distribuição de Perfis (Rosca) -->
        <div class="chart-card">
          <h3 class="chart-header">Distribuição de Perfis</h3>
          <div class="chart-half-size">
            <canvas #distributionChart></canvas>
          </div>
        </div>

        <!-- 3C. Criação de Conteúdo ao Longo do Tempo (Barras) -->
        <div class="chart-card">
          <h3 class="chart-header">Criação de Conteúdo (Mensal)</h3>
          <div class="chart-half-size">
            <canvas #contentCreationChart></canvas>
          </div>
        </div>
      </div>

      <!-- 3D. Engajamento de Rotas (Top 5) -->
      <div class="chart-card">
        <h3 class="chart-header">Top 5 Rotas Mais Engajadas</h3>
        <div class="chart-canvas">
          <canvas #engagementChart></canvas>
        </div>
      </div>

      <!-- 3E. Mapa de Densidade de Conteúdo (Mock) -->
      <div class="chart-card">
        <h3 class="chart-header">Densidade de Conteúdo Geográfico (Mock)</h3>
        <div class="chart-canvas" style="height: 350px">
          <iframe
            width="100%"
            height="100%"
            style="border: 0; border-radius: 8px"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d117364.55073427976!2d-48.16914561842045!3d-23.47353932644246!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c6328a9b244799%3A0x63428d022b39f3c!2sInterior%20de%20S%C3%A3o%20Paulo!5e0!3m2!1spt-BR!2sbr!4v1717462000000!5m2!1spt-BR!2sbr"
          ></iframe>
          <p
            style="
              text-align: center;
              font-size: 0.8rem;
              color: var(--text-color-light);
              margin-top: 0.5rem;
            "
          >
            *Mapa representando a área do Interior de SP. O filtro geográfico alteraria os dados.
          </p>
        </div>
      </div>
    </div>
  </main>
  }

  <app-bottom-menu></app-bottom-menu>
</div>
