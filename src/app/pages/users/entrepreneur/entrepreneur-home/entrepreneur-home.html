<div class="home-container">

  <app-header-title [title]="'Comércio'" [subtitle]="'Visualização de informações importantes'"></app-header-title>

  @if (isLoading) {
  <main class="home-content loading-state">
    <p>Carregando dados...</p>
  </main>
  } @else {
  <main class="home-content">

    @if (hasBusiness && businessData) {
    <div class="dashboard-container">

      <section class="dashboard-card business-header">
        <div class="business-info">
          <img [src]="businessData.logoUrl" alt="Logo do Comércio" class="business-logo" />
          <div class="business-name">
            <h3>{{ businessData.name }}</h3>
            <p>{{ businessData.address }}</p>
          </div>
          <button mat-icon-button (click)="refreshData()" class="refresh-button">
            <mat-icon>refresh</mat-icon>
          </button>
        </div>

        <div class="business-stats">
          <div class="stat-item">
            <span>Visitantes</span>
            <strong>{{ businessData.visitors }}</strong>
          </div>
          <div class="stat-item">
            <span>Avaliações</span>
            <div class="star-rating">
              @for (isFilled of ratingStars; track $index) {
              <mat-icon>{{ isFilled ? 'star' : 'star_border' }}</mat-icon>
              }
            </div>
          </div>
        </div>

        <div class="business-tags">
          <span class="tag-item"><mat-icon>attach_money</mat-icon> {{ businessData.priceRange }}</span>
          <span class="tag-item"><mat-icon>schedule</mat-icon> {{ businessData.hours }}</span>
          <span class="tag-item"><mat-icon>storefront</mat-icon> {{ businessData.category }}</span>
        </div>
      </section>

      <section class="dashboard-card routes-map-card">
        <div class="routes-info">
          <span class="routes-label">Seu comércio está em</span>
          <strong class="routes-count">{{ businessData.routesCount }}</strong>
          <span class="routes-label">Rotas</span>
        </div>
        <div class="map-placeholder">
          <iframe class="map-iframe" width="100%" height="100%" style="border: 0" loading="lazy" allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d58673.07921890356!2d-47.88725831102927!3d-23.3512140669299!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c5d8e7b165296d%3A0x6a0a09e0a80e1c31!2sTatu%C3%AD%2C%20SP!5e0!3m2!1spt-BR!2sbr!4v1730219812345!5m2!1spt-BR!2sbr">
          </iframe>
        </div>
      </section>

      <section class="dashboard-card visitors-card">
        <div class="card-header">
          <h4>Visitantes</h4>
          <button mat-flat-button class="filter-button">Hoje</button>
        </div>
        <div class="graph-placeholder">
          <canvas #visitorsChart></canvas>
        </div>
        <p class="visitors-footer">{{ businessData.monthlyVisitors }} visitantes no mês</p>
      </section>

      <section class="dashboard-card reviews-card">
        <div class="reviews-icon">
          <mat-icon>reviews</mat-icon>
        </div>
        <div class="reviews-text">
          <strong>Avaliações</strong>
          <p>Confira como os viajantes avaliam o seu comércio.</p>
        </div>
        <mat-icon class="reviews-arrow">chevron_right</mat-icon>
      </section>

    </div>
    } @else {
    <div class="empty-state-container">
      <mat-icon class="empty-state-icon">storefront</mat-icon>
      <button mat-flat-button color="primary" class="empty-state-button" (click)="navigateToRegisterCommerce()">
        Cadastrar comércio
      </button>
    </div>
    }
  </main>
  }

  <app-bottom-menu></app-bottom-menu>

</div>